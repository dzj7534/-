<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/bootstrap.css">
</head>
<body>
<div class="box">
    <h2 class="text-center">诉求信息</h2>
    <button href="" type="button" class="btn btn-sm btn-primary save" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="width: 120px;">首页</button>
    <form  action="pingfen" method="post">
        <table class="table table-striped table-hover data-grid">
            <thead>
            <th>
            <td>单号</td>
            <td>投诉时间</td>
            <td>投诉类别</td>
            <td>投诉内容</td>
            <td>目前状态</td>
            <td>工作人员留言</td>
            <td>评分(10分制)</td>
            <td></td>
            <td>
            </td>
            </th>
            </thead>
            <tbody>

            <tbody id="test">

            </tbody>
        </table>
    </form>

    <nav aria-label="Page navigation example">
        <ul class="pagination">
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<script src="./js/bootstrap.js"></script>
<script>
    var message_id = 0;

    $(document).ready(function() {
        $.ajax({
            url : "showStu",//后台请求的数据，用的是PHP
            dataType : "json",//数据格式
            type : "post",//请求方式
            async : false,//false:同步   true:异步
            success : function(data) {   //如果请求成功，返回数据。
                console.log("前端请求后端成功，返回了数据");
                var html = "";
                for(var i=0;i<data.length;i++){    //遍历data数组
                    var ls = data[i];
                    message_id = ls.message_id
                    var words = ls.words;

                    if(typeof ls.words =="undefined"){
                        words = "目前未留言";
                    }
                    console.log(ls.message_id);
                    html +=
                        "<tr>"
                        +"<td>"+"</td>"//空

                        +"<td>"+ls.message_id+"</td>"//单号
                        +"<td>"+ls.submission_time+"</td>"//投诉时间
                        +"<td>"+ls.meaning+"</td>"//投诉类别
                        +"<td>"+ls.content+"</td>"//投诉内容
                        +"<td>"+ls.state+"</td>"//目前状态
                        +"<td>"+words+"</td>"//留言
                        +"<td>"+
                        '<input name = "pingfen" id = "pingfen" size="2">'
                        +"</td>"
                        +"<td>"+'<input type="submit" class="btn btn-sm btn-danger" value="提&nbsp;&nbsp;&nbsp;&nbsp;交">'
                        +"</td>"+

                        "</tr>";

                }
                $("#test").html(html); //在html页面id=test的标签里显示html内容
            },
        })
    });

    $(document).ready(function(){
        var jsondata={                                           //定义一个json对象，用于存储数据
            "message_id" : message_id,
        }
        console.log("message_id---"+message_id)
        $.ajax({                                    //调用ajax发送数据
            type:"get",
            url:"pingfen",                          //发送给后台的url声明
            data:jsondata,
            async : false,
            // success:function () {               //发送成功并且成功获得后台响应的时候，
            //     alert(message_id+"成功"); //执行的操作
            // },
            // error:function () {                    //发送失败了该执行的操作
            //     alert("发生未知错误");
            // }
        });
    });

</script>
</body>
</html>